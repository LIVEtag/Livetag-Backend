Chat module
-------------------
##### Краткое описание
* Система  взаимодействует с сервером центрифуги  докер окружение [тут]( https://git.gbksoft.net/Docker/Web-Apache-Centrifugo)
* Клиент подписывается на сервер центрифуги и получает сообщения.
* По-умолчанию публикация в канал с клиента запрещена. Для того, чтобы опубликовать сообщение, пользоватль отправляет его на API endpoint, которое сохраняет сообщение в базу и после этого публикует в канал `от имени` пользователя (через API центрифуги)

> На самом деле, при взаимодействии с API центрифуги опция `публикация от имени` не предусмотрена. Поэтому информация об пользователе передается в теле сообщения.

##### Сущности и их взаимодействия
Канал (чат, комната) - основная сущность с которой взаимодействуют пользователи. Каналы бывают приватные и публичные. Для примера взяты 2 роли пользоватея (`ROLE_BASIC` и  `ROLE_ADVANCED`). Управление каналами доступно только Advanced пользователям.
###### Роли
Чтобы публиковать сообщения в чате, пользователь должен в нем состоять. Для канала доступны 2 роли:
* Администратор - может обновлять информацию о канале ![](https://w3tls.net/bHN3Co6d79f0148f4de5d41c444a7b4ff39004.png), а также управлять пользователями в нем (добавлять/удалять).
* Пользователь - может только публиковать сообщения.
###### Управление
Создать канал может только Advanced пользователь: ![](https://w3tls.net/bHN3Cofd9734e800308d72328a465f0b8d8596.png)   Пользователь, который создал канал, автоматически в него входит с правами администратора канала.
Удаление доступно только администратору: ![](https://w3tls.net/bHN3Cocd91a0362aacefb6f8a8fa379fc0a1cd.png). В рамках демонстрации канал со всеми сообщениями просто удаляется. (При необходимости можно реализовать логику 'отметить канал удаленным и скрыть')
###### Доступ к каналам
`Публичный` канал доступен для всех. Информацию о канале, а также его содержимое публично. Однако, чтобы писать сообщения, в него надо вступить. Для этого есть методы присоеденения: ![](https://w3tls.net/bHN3Coc9766e7551c69370b5b5ebf696936d94.png) и отсоединения от канала: ![](https://w3tls.net/bHN3Coba1aa5f261017473286d1846087b672b.png)
`Приватный` канал доступен только для его членов. Управление пользователяит доступно только администратору канала (по-умолчанию это создатель приватной комнаты). Для этого есть методы методы добавления: ![](https://w3tls.net/bHN3Co4107bdd3b0cc3c107f283f10a4a71152.png) и удаления: ![](https://w3tls.net/bHN3Cofe2a25f417bbefb55daf2e3838b94480.png) пользователя. Пользователь может покинуть канал по своему желанию, но вернуться уже не сможет.
###### Информация о каналах
* Метод получения списка каналов возвращает все публичные каналы + приватные, в которых пользователь состоит: ![](https://w3tls.net/bHN3Co6b38e8d7a5798725462b01f5ad551b13.png)
* Информация о канале: ![](https://w3tls.net/bHN3Co21c98518504123b5707420d4e1047d55.png)
* Получение сообщений канала: ![](https://w3tls.net/bHN3Co56b4068657084ab6766d3a18bd2a3146.png) в формате, совместимым с сообщениями, которые приходят от центрифуги
* Список пользователей канала: ![](https://w3tls.net/bHN3Co9cac23f00c9243dc2bc4627a412fd846.png)
###### Методы для центрифуги
* Базовая авторизация: ![](https://w3tls.net/bHN3Coe91bb8a830c5ec68ff9478c50a501230.png) - первоначальное получение конфига (с токеном) для соединения с центрифугой, а также для [поддержания соединения](https://fzambia.gitbooks.io/centrifugal/content/server/connection_check.html)
* Авторизация в приватных каналах: ![](https://w3tls.net/bHN3Cof563f46d49ceb3e5c446551fea6c7d61.png) - вызывается js библиотекой центрифуги [автоматически](https://fzambia.gitbooks.io/centrifugal/content/clients/javascript.html#private-channels) при регистрации в приватном канале.
###### Демо
В рамках базовового проекто была создана демонстрация чата. В зависимости от базовой ссылки, его можно посмотреть тут: [http://yii2-base.local/frontend/web/demo-chat/](http://yii2-base.local/frontend/web/demo-chat/)